{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0rc1", "generated_at": "2025-11-22T05:15:50.480946Z", "invocation_id": "4536929b-85dd-4cc2-b1b6-0b69b06fbe2c", "invocation_started_at": "2025-11-22T05:15:38.205652Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.932146Z", "completed_at": "2025-11-22T05:15:44.934448Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.939359Z", "completed_at": "2025-11-22T05:15:44.939390Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.05598783493041992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.snowflake_finops.budget_daily", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.935167Z", "completed_at": "2025-11-22T05:15:44.937347Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.940308Z", "completed_at": "2025-11-22T05:15:44.940320Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05620002746582031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.snowflake_finops.demo", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.949082Z", "completed_at": "2025-11-22T05:15:44.951617Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.953060Z", "completed_at": "2025-11-22T05:15:44.953079Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0066471099853515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.snowflake_finops.department_mapping", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.953928Z", "completed_at": "2025-11-22T05:15:44.973129Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.973861Z", "completed_at": "2025-11-22T05:15:44.973882Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.025536537170410156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.dbt_utils_unique_combination_of_columns_budget_daily_date__department.b6ffa07129", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        date, department\n    from DM_AE_FINOPS_DB.STG.budget_daily\n    group by date, department\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.962033Z", "completed_at": "2025-11-22T05:15:44.976562Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.982290Z", "completed_at": "2025-11-22T05:15:44.982311Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.021605730056762695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_budget_daily_budget_usd.a6e5da8943", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect budget_usd\nfrom DM_AE_FINOPS_DB.STG.budget_daily\nwhere budget_usd is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.977100Z", "completed_at": "2025-11-22T05:15:44.984774Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.985771Z", "completed_at": "2025-11-22T05:15:44.985782Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01047205924987793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_budget_daily_date.182e0a0821", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date\nfrom DM_AE_FINOPS_DB.STG.budget_daily\nwhere date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.986542Z", "completed_at": "2025-11-22T05:15:44.997842Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:44.998634Z", "completed_at": "2025-11-22T05:15:44.998650Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.014757633209228516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_budget_daily_department.f34a3b2373", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect department\nfrom DM_AE_FINOPS_DB.STG.budget_daily\nwhere department is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.993857Z", "completed_at": "2025-11-22T05:15:44.999786Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:45.000284Z", "completed_at": "2025-11-22T05:15:45.000294Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0077016353607177734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.dim_department", "compiled": true, "compiled_code": "\n\nselect\n    upper(trim(warehouse_name)) as warehouse_name,\n    trim(department) as department\nfrom DM_AE_FINOPS_DB.STG.department_mapping", "relation_name": "DM_AE_FINOPS_DB.STG.dim_department", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.908281Z", "completed_at": "2025-11-22T05:15:46.832575Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:46.833142Z", "completed_at": "2025-11-22T05:15:46.833155Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.950268268585205, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.stg_warehouse_metering", "compiled": true, "compiled_code": "\n\n\n\n\n  \n  \n    \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n\n    \n    \n\n    \n      \n      \n    \n\n    \n      \n    \n  \n\n\n-- Authoritative (ACCOUNT_USAGE) or Demo overlay via macro\nwith source as (\n    select *\n    from \n    SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY\n  \n    where START_TIME >= dateadd('day', -30, current_date())\n    \n      \n        and date_trunc('hour', END_TIME::timestamp_ntz) >= (\n            select coalesce(\n                dateadd('hour', -1, max(usage_hour_ntz)),\n                '1970-01-01'::timestamp_ntz\n            )\n            from DM_AE_FINOPS_DB.STG.stg_warehouse_metering\n        )\n      \n    \n),\n\n-- Normalize and add cost ($ = credits * cost_per_credit)\nnormalized as (\n    select\n        -- keys & time (normalize to NTZ hour)\n        date_trunc('hour', END_TIME::timestamp_ntz) as usage_hour_ntz,\n        date_trunc('hour', START_TIME::timestamp_ntz) as hour_start,\n        date_trunc('hour', END_TIME::timestamp_ntz) as hour_end,\n        cast(date_trunc('day', END_TIME::timestamp_ntz) as date) as usage_date,\n\n        -- warehouse\n        WAREHOUSE_ID,\n        WAREHOUSE_NAME,\n\n        -- credits (ACCOUNT_USAGE-compatible column names)\n        CREDITS_USED                       as total_credits_used,\n        CREDITS_USED_COMPUTE               as credits_used_compute,\n        CREDITS_USED_CLOUD_SERVICES        as credits_used_cloud_services,\n\n        -- dollars (authoritative)\n        (CREDITS_USED * 3.0)                as total_cost_usd,\n        (CREDITS_USED_COMPUTE * 3.0)        as compute_cost_usd,\n        (CREDITS_USED_CLOUD_SERVICES * 3.0) as cloud_services_cost_usd,\n\n        -- stable unique key per warehouse-hour\n        concat_ws('|', WAREHOUSE_ID::string, to_char(date_trunc('hour', END_TIME::timestamp_ntz), 'YYYY-MM-DD HH24:MI:SS')) as metering_id,\n\n        -- cast to ntz for stability downstream\n        cast(current_timestamp() as timestamp_ntz) as _loaded_at\n    from source\n)\n\nselect\n    usage_hour_ntz,\n    hour_start,\n    hour_end,\n    usage_date,\n    WAREHOUSE_ID   as warehouse_id,\n    WAREHOUSE_NAME as warehouse_name,\n    total_credits_used,\n    credits_used_compute,\n    credits_used_cloud_services,\n    compute_cost_usd,\n    cloud_services_cost_usd,\n    (total_cost_usd - compute_cost_usd) as idle_cost_usd, -- informational; equals cloud_services_cost_usd\n    total_cost_usd,\n    metering_id,\n    _loaded_at\nfrom normalized", "relation_name": "DM_AE_FINOPS_DB.STG.stg_warehouse_metering", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:46.842939Z", "completed_at": "2025-11-22T05:15:46.848954Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:46.849505Z", "completed_at": "2025-11-22T05:15:46.849518Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.013150930404663086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_stg_warehouse_metering_usage_hour_ntz.d23c9862eb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect usage_hour_ntz\nfrom DM_AE_FINOPS_DB.STG.stg_warehouse_metering\nwhere usage_hour_ntz is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:46.838145Z", "completed_at": "2025-11-22T05:15:46.850466Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:46.851085Z", "completed_at": "2025-11-22T05:15:46.851094Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.015512228012084961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.monitor_freshness_check", "compiled": true, "compiled_code": "\n\nselect max(hour_end) as last_end_time\nfrom DM_AE_FINOPS_DB.STG.stg_warehouse_metering", "relation_name": "DM_AE_FINOPS_DB.STG.monitor_freshness_check", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:44.886918Z", "completed_at": "2025-11-22T05:15:47.208659Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:47.209183Z", "completed_at": "2025-11-22T05:15:47.209196Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.3269827365875244, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.stg_query_history", "compiled": true, "compiled_code": "\n\n\n\n\n  \n  \n    \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n\n    \n    \n\n    \n      \n      \n    \n\n    \n      \n    \n  \n\n\nwith source as (\n    select *\n    from SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY\n    where START_TIME >= dateadd('day', -30, current_date())\n    \n      \n        and date_trunc('hour', END_TIME::timestamp_ntz) >= (\n            select coalesce(\n                dateadd('hour', -1, max(usage_hour_ntz)),\n                '1970-01-01'::timestamp_ntz\n            )\n            from DM_AE_FINOPS_DB.STG.stg_query_history\n        )\n      \n    \n),\n\nfiltered as (\n    select *\n    from source\n    where EXECUTION_STATUS = 'SUCCESS'\n      and WAREHOUSE_NAME is not null   -- only compute-bearing statements\n),\n\ntransformed as (\n    select\n        -- Keys & time\n        QUERY_ID                                                     as query_id,\n        date_trunc('hour', END_TIME::timestamp_ntz)                   as usage_hour_ntz,\n        date_trunc('hour', START_TIME::timestamp_ntz)                 as hour_start_ntz,\n        date_trunc('hour', END_TIME::timestamp_ntz)                   as hour_end_ntz,\n        cast(date_trunc('day', END_TIME::timestamp_ntz) as date)      as usage_date,\n        START_TIME,\n        END_TIME,\n\n        -- Who/where\n        USER_NAME       as user_name,\n        ROLE_NAME       as role_name,\n        WAREHOUSE_NAME  as warehouse_name,\n        WAREHOUSE_SIZE  as warehouse_size,\n\n        -- What\n        QUERY_TYPE      as query_type,\n        DATABASE_NAME   as database_name,\n        SCHEMA_NAME     as schema_name,\n        EXECUTION_STATUS,\n        BYTES_SCANNED,\n        ROWS_PRODUCED,\n        TOTAL_ELAPSED_TIME as total_elapsed_ms,\n        EXECUTION_TIME     as execution_ms,\n\n        -- Convenience fields\n        BYTES_SCANNED / 1024 / 1024 / 1024.0 as gb_scanned,\n        TOTAL_ELAPSED_TIME / 1000.0          as total_elapsed_seconds,\n\n        case\n            when TOTAL_ELAPSED_TIME > 600000 then 'long_running'   -- > 10 min\n            when TOTAL_ELAPSED_TIME > 60000  then 'medium_running' -- > 1 min\n            else 'fast'\n        end as runtime_category,\n\n        cast(current_timestamp() as timestamp_ntz) as _loaded_at\n    from filtered\n)\n\nselect * from transformed", "relation_name": "DM_AE_FINOPS_DB.STG.stg_query_history", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:47.234482Z", "completed_at": "2025-11-22T05:15:47.242492Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:47.243110Z", "completed_at": "2025-11-22T05:15:47.243124Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.030805349349975586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_stg_query_history_usage_hour_ntz.968cbc160c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect usage_hour_ntz\nfrom DM_AE_FINOPS_DB.STG.stg_query_history\nwhere usage_hour_ntz is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:47.214153Z", "completed_at": "2025-11-22T05:15:49.813674Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.814208Z", "completed_at": "2025-11-22T05:15:49.814219Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.6024649143218994, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.int_hourly_compute_costs", "compiled": true, "compiled_code": "\n\n\n\n\n  \n  \n    \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n      \n    \n\n    \n    \n\n    \n      \n      \n    \n\n    \n      \n      \n    \n\n    \n      \n      \n    \n\n    \n      \n    \n  \n\n\nwith metering as (\n    select *\n    from DM_AE_FINOPS_DB.STG.stg_warehouse_metering\n    \n        \n            where usage_hour_ntz >= (\n                select coalesce(\n                    dateadd('hour', -1, max(usage_hour_ntz)),\n                    '1970-01-01'::timestamp_ntz\n                )\n                from DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\n            )\n        \n    \n),\n\nqueries as (\n    select\n        warehouse_name,\n        usage_hour_ntz,\n        count(*)                         as query_count,\n        sum(total_elapsed_seconds)       as total_runtime_seconds,\n        sum(gb_scanned)                  as total_gb_scanned,\n        count(distinct user_name)        as unique_users\n    from DM_AE_FINOPS_DB.STG.stg_query_history\n    \n        \n            where usage_hour_ntz >= (\n                select coalesce(\n                    dateadd('hour', -1, max(usage_hour_ntz)),\n                    '1970-01-01'::timestamp_ntz\n                )\n                from DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\n            )\n        \n    \n    group by 1, 2\n),\n\nhourly_costs as (\n    select\n        m.usage_hour_ntz,\n        m.hour_start,\n        m.hour_end,\n        cast(m.usage_hour_ntz as date) as usage_date,\n        m.warehouse_id,\n        m.warehouse_name,\n\n        -- Actual costs from metering (authoritative)\n        m.total_credits_used,\n        m.total_cost_usd,\n        m.compute_cost_usd,\n        m.cloud_services_cost_usd,\n\n        -- Query activity in this hour\n        coalesce(q.query_count, 0)           as queries_executed,\n        coalesce(q.total_runtime_seconds, 0) as total_runtime_seconds,\n        coalesce(q.total_gb_scanned, 0)      as gb_scanned,\n        coalesce(q.unique_users, 0)          as unique_users,\n\n        -- Efficiency metrics\n        case\n            when coalesce(q.query_count, 0) > 0 then m.total_cost_usd / q.query_count\n            else null\n        end as avg_cost_per_query,\n\n        case\n            when coalesce(q.total_runtime_seconds, 0) > 0 then m.total_cost_usd / (q.total_runtime_seconds / 3600.0)\n            else null\n        end as cost_per_runtime_hour,\n\n        -- Idle detection (no queries but credits consumed)\n        case\n            when coalesce(q.query_count, 0) = 0 and m.total_credits_used > 0 then true\n            else false\n        end as is_potentially_idle,\n\n        case\n            when coalesce(q.query_count, 0) = 0 and m.total_credits_used > 0 then m.total_cost_usd\n            else 0\n        end as idle_cost_usd,\n\n        -- Composite key\n        md5(cast(coalesce(cast(m.warehouse_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(m.usage_hour_ntz as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as cost_hour_key,\n\n        cast(current_timestamp() as timestamp_ntz) as _loaded_at\n    from metering m\n    left join queries q\n        on m.warehouse_name = q.warehouse_name\n       and m.usage_hour_ntz = q.usage_hour_ntz\n)\n\nselect * from hourly_costs", "relation_name": "DM_AE_FINOPS_DB.STG.int_hourly_compute_costs", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.822539Z", "completed_at": "2025-11-22T05:15:49.848867Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.850616Z", "completed_at": "2025-11-22T05:15:49.850632Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03333735466003418, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.fct_daily_costs", "compiled": true, "compiled_code": "\n\nwith compute_costs as (\n    select\n        usage_date,\n        warehouse_name,\n\n        -- Rollups from authoritative hourly costs\n        sum(total_credits_used)         as compute_credits,\n        sum(compute_cost_usd)           as compute_cost,\n        sum(cloud_services_cost_usd)    as cloud_services_cost,\n        sum(total_cost_usd)             as total_cost,\n\n        -- Existing signals\n        sum(idle_cost_usd)              as idle_cost,\n        sum(queries_executed)           as total_queries,\n        avg(unique_users)               as avg_concurrent_users\n    from DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\n    group by 1, 2\n),\n\ndaily_summary as (\n    select\n        -- Contract-friendly explicit types\n        usage_date::date                                   as usage_date,\n        warehouse_name::varchar                            as warehouse_name,\n\n        compute_credits::number(38,3)                      as compute_credits,\n        compute_cost::number(38,2)                         as compute_cost,\n        cloud_services_cost::number(38,2)                  as cloud_services_cost,\n        total_cost::number(38,2)                           as total_cost,\n\n        idle_cost::number(38,2)                            as idle_cost,\n        (compute_cost - idle_cost)::number(38,2)           as productive_cost,\n\n        total_queries::number(38,0)                        as total_queries,\n        avg_concurrent_users::number(38,2)                 as avg_concurrent_users,\n\n        case when total_queries > 0\n             then (compute_cost / nullif(total_queries,0))::number(38,4)\n        end                                                as cost_per_query,\n\n        case when compute_cost > 0\n             then (100 * (1 - (idle_cost / nullif(compute_cost,0))))::number(5,2)\n             else 100::number(5,2)\n        end                                                as efficiency_score,\n\n        -- Use TOTAL for running/MA signals (holistic)\n        sum(total_cost) over (\n            partition by date_trunc('month', usage_date), warehouse_name\n            order by usage_date\n        )::number(38,2)                                    as month_to_date_cost,\n\n        avg(total_cost) over (\n            partition by warehouse_name\n            order by usage_date\n            rows between 6 preceding and current row\n        )::number(38,2)                                    as cost_7day_avg,\n\n        (total_cost - lag(total_cost, 1) over (\n            partition by warehouse_name order by usage_date\n        ))::number(38,2)                                   as day_over_day_change,\n\n        (total_cost - lag(total_cost, 7) over (\n            partition by warehouse_name order by usage_date\n        ))::number(38,2)                                   as week_over_week_change\n\n    from compute_costs\n)\n\nselect\n    *,\n    md5(cast(coalesce(cast(usage_date as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(warehouse_name as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as daily_cost_key,\n    cast(current_timestamp() as timestamp_ntz) as _loaded_at\nfrom daily_summary", "relation_name": "DM_AE_FINOPS_DB.STG.fct_daily_costs", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.833999Z", "completed_at": "2025-11-22T05:15:49.849818Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.852501Z", "completed_at": "2025-11-22T05:15:49.852512Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03279924392700195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_int_hourly_compute_costs_usage_hour_ntz.076291f0ca", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect usage_hour_ntz\nfrom DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\nwhere usage_hour_ntz is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.828647Z", "completed_at": "2025-11-22T05:15:49.851427Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.853582Z", "completed_at": "2025-11-22T05:15:49.853595Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03458809852600098, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_int_hourly_compute_costs_cost_hour_key.df6759a8e8", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cost_hour_key\nfrom DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\nwhere cost_hour_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.839299Z", "completed_at": "2025-11-22T05:15:49.851998Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.855139Z", "completed_at": "2025-11-22T05:15:49.855148Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03426480293273926, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.unique_int_hourly_compute_costs_cost_hour_key.d29c10caee", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    cost_hour_key as unique_field,\n    count(*) as n_records\n\nfrom DM_AE_FINOPS_DB.STG.int_hourly_compute_costs\nwhere cost_hour_key is not null\ngroup by cost_hour_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.862005Z", "completed_at": "2025-11-22T05:15:49.882615Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.884362Z", "completed_at": "2025-11-22T05:15:49.884379Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.027391433715820312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.fct_budget_vs_actual", "compiled": true, "compiled_code": "\n\nwith daily_actuals as (\n  select\n    f.usage_date,\n    coalesce(nullif(trim(m.department), ''), 'Unassigned') as department,\n    sum(f.compute_cost + f.idle_cost) as actual_cost_usd\n  from DM_AE_FINOPS_DB.STG.fct_daily_costs f\n  left join DM_AE_FINOPS_DB.STG.department_mapping m\n    on upper(f.warehouse_name) = upper(m.warehouse_name)\n  group by 1,2\n),\nbudget as (\n  select\n    cast(b.date as date) as usage_date,\n    trim(b.department)    as department,\n    b.budget_usd\n  from DM_AE_FINOPS_DB.STG.budget_daily b\n)\nselect\n  coalesce(a.usage_date, b.usage_date) as usage_date,\n  coalesce(a.department, b.department) as department,\n  coalesce(a.actual_cost_usd, 0)       as actual_cost_usd,\n  coalesce(b.budget_usd, 0)            as budget_usd\nfrom daily_actuals a\nfull outer join budget b\n  on a.usage_date = b.usage_date\n and a.department = b.department\norder by 1,2", "relation_name": "DM_AE_FINOPS_DB.STG.fct_budget_vs_actual", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.867664Z", "completed_at": "2025-11-22T05:15:49.883692Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.886256Z", "completed_at": "2025-11-22T05:15:49.886270Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.028045177459716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.fct_cost_by_department", "compiled": true, "compiled_code": "\n\nwith base as (\n    select\n        f.usage_date,\n        coalesce(nullif(trim(m.department), ''), 'Unassigned') as department,\n        f.warehouse_name,\n        f.compute_cost as compute_cost_usd,\n        f.idle_cost     as idle_cost_usd,\n        (f.compute_cost + f.idle_cost) as total_cost_usd\n    from DM_AE_FINOPS_DB.STG.fct_daily_costs f\n    left join DM_AE_FINOPS_DB.STG.department_mapping m\n      on upper(f.warehouse_name) = upper(m.warehouse_name)\n)\nselect\n    usage_date,\n    department,\n    sum(compute_cost_usd) as compute_cost_usd,\n    sum(idle_cost_usd)    as idle_cost_usd,\n    sum(total_cost_usd)   as total_cost_usd\nfrom base\ngroup by 1, 2", "relation_name": "DM_AE_FINOPS_DB.STG.fct_cost_by_department", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.876807Z", "completed_at": "2025-11-22T05:15:49.885207Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.887658Z", "completed_at": "2025-11-22T05:15:49.887671Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.027721405029296875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.dbt_expectations_expect_column_values_to_be_between_fct_daily_costs_compute_cost__0.27c452adce", "compiled": true, "compiled_code": "\n\n\n\n\n\n\n    with grouped_expression as (\n    select\n        \n        \n    \n  \n( 1=1 and compute_cost >= 0\n)\n as expression\n\n\n    from DM_AE_FINOPS_DB.STG.fct_daily_costs\n    \n\n),\nvalidation_errors as (\n\n    select\n        *\n    from\n        grouped_expression\n    where\n        not(expression = true)\n\n)\n\nselect *\nfrom validation_errors\n\n\n\n\n\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.872105Z", "completed_at": "2025-11-22T05:15:49.885748Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.888690Z", "completed_at": "2025-11-22T05:15:49.888699Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02987837791442871, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.snowflake_finops.fct_cost_trend", "compiled": true, "compiled_code": "\n\nselect\n    usage_date,\n    sum(compute_cost) as compute_cost_usd,\n    sum(idle_cost)    as idle_cost_usd,\n    sum(compute_cost + idle_cost) as total_cost_usd\nfrom DM_AE_FINOPS_DB.STG.fct_daily_costs\ngroup by 1\norder by 1", "relation_name": "DM_AE_FINOPS_DB.STG.fct_cost_trend", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.894618Z", "completed_at": "2025-11-22T05:15:49.915435Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.922802Z", "completed_at": "2025-11-22T05:15:49.922815Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03279447555541992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.dbt_expectations_expect_column_values_to_be_between_fct_daily_costs_idle_cost__0.63ad1ff7b4", "compiled": true, "compiled_code": "\n\n\n\n\n\n\n    with grouped_expression as (\n    select\n        \n        \n    \n  \n( 1=1 and idle_cost >= 0\n)\n as expression\n\n\n    from DM_AE_FINOPS_DB.STG.fct_daily_costs\n    \n\n),\nvalidation_errors as (\n\n    select\n        *\n    from\n        grouped_expression\n    where\n        not(expression = true)\n\n)\n\nselect *\nfrom validation_errors\n\n\n\n\n\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.901518Z", "completed_at": "2025-11-22T05:15:49.921528Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.923864Z", "completed_at": "2025-11-22T05:15:49.923875Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.032030582427978516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_fct_daily_costs_usage_date.a508445774", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect usage_date\nfrom DM_AE_FINOPS_DB.STG.fct_daily_costs\nwhere usage_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.909074Z", "completed_at": "2025-11-22T05:15:49.922248Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.925247Z", "completed_at": "2025-11-22T05:15:49.925257Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03231334686279297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.relationships_fct_daily_costs_warehouse_name__warehouse_name__ref_stg_warehouse_metering_.bdcce88074", "compiled": true, "compiled_code": "\n    \n    \n\nwith child as (\n    select warehouse_name as from_field\n    from DM_AE_FINOPS_DB.STG.fct_daily_costs\n    where warehouse_name is not null\n),\n\nparent as (\n    select warehouse_name as to_field\n    from DM_AE_FINOPS_DB.STG.stg_warehouse_metering\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.916047Z", "completed_at": "2025-11-22T05:15:49.924740Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.927400Z", "completed_at": "2025-11-22T05:15:49.927413Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03393721580505371, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.unique_fct_daily_costs_daily_cost_key.745882193a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    daily_cost_key as unique_field,\n    count(*) as n_records\n\nfrom DM_AE_FINOPS_DB.STG.fct_daily_costs\nwhere daily_cost_key is not null\ngroup by daily_cost_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.932078Z", "completed_at": "2025-11-22T05:15:49.949252Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.950162Z", "completed_at": "2025-11-22T05:15:49.950177Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.021517515182495117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.dbt_utils_unique_combination_of_columns_fct_budget_vs_actual_usage_date__department.a0e6a2473c", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        usage_date, department\n    from DM_AE_FINOPS_DB.STG.fct_budget_vs_actual\n    group by usage_date, department\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.937783Z", "completed_at": "2025-11-22T05:15:49.951095Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.952271Z", "completed_at": "2025-11-22T05:15:49.952286Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02304530143737793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_fct_budget_vs_actual_department.56c6e56da8", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect department\nfrom DM_AE_FINOPS_DB.STG.fct_budget_vs_actual\nwhere department is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-22T05:15:49.943327Z", "completed_at": "2025-11-22T05:15:49.951575Z"}, {"name": "execute", "started_at": "2025-11-22T05:15:49.953103Z", "completed_at": "2025-11-22T05:15:49.953116Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.023183822631835938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.snowflake_finops.not_null_fct_budget_vs_actual_usage_date.99d3503a97", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect usage_date\nfrom DM_AE_FINOPS_DB.STG.fct_budget_vs_actual\nwhere usage_date is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 8.44586706161499, "args": {"profiles_dir": "./.ci/profiles", "defer": false, "compile": true, "empty_catalog": false, "log_level": "info", "require_nested_cumulative_type_params": false, "log_format_file": "debug", "use_colors": true, "print": true, "skip_nodes_if_on_run_start_fails": false, "use_fast_test_edges": false, "favor_state": false, "macro_debugging": false, "require_generic_test_arguments_property": true, "show_all_deprecations": false, "upload_to_artifacts_ingest_api": false, "show_resource_report": false, "require_all_warnings_handled_by_warn_error": false, "require_resource_names_without_spaces": true, "log_level_file": "debug", "log_path": "/home/runner/work/finops-dbt/finops-dbt/logs", "partial_parse": true, "introspect": true, "use_colors_file": true, "state_modified_compare_more_unrendered_values": false, "target": "prod", "source_freshness_run_project_hooks": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "state_modified_compare_vars": false, "static_parser": true, "invocation_command": "dbt docs generate --profiles-dir ./.ci/profiles --target prod --target-path target/base --vars {\"enable_pro_pack\": false, \"DEMO_MODE\": false} --exclude tag:backlog --exclude source:account_usage_backlog --exclude fqn:metering_demo_seed,resource_type:seed --exclude fqn:metering_overlay,resource_type:model", "populate_cache": true, "version_check": true, "printer_width": 80, "require_batched_execution_for_custom_microbatch_strategy": false, "target_path": "target/base", "static": false, "vars": {"enable_pro_pack": false, "DEMO_MODE": false}, "which": "generate", "write_json": true, "exclude": ["tag:backlog", "source:account_usage_backlog", "fqn:metering_demo_seed,resource_type:seed", "fqn:metering_overlay,resource_type:model"], "validate_macro_args": false, "log_format": "default", "quiet": false, "require_yaml_configuration_for_mf_time_spines": false, "partial_parse_file_diff": true, "strict_mode": false, "require_explicit_package_overrides_for_builtin_materializations": true, "indirect_selection": "eager", "project_dir": "/home/runner/work/finops-dbt/finops-dbt", "log_file_max_bytes": 10485760, "send_anonymous_usage_stats": true, "select": [], "cache_selected_only": false}}